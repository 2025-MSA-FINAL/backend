<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.popspot.popupplatform.mapper.admin.AdminUserMapper">

    <!-- 유저 목록 조회 (USER 역할만) -->
    <select id="getUserList" resultType="com.popspot.popupplatform.dto.admin.AdminUserDTO">
        SELECT
        user_id AS userId,
        user_name AS userName,
        user_nickname AS userNickname,
        user_email AS userEmail,
        user_phonenumber AS userPhonenumber,
        user_gender AS userGender,
        user_birthyear AS userBirthyear,
        user_status AS userStatus,
        user_role AS userRole,
        created_at AS createdAt,
        updated_at AS updatedAt
        FROM USER
        WHERE user_role = 'USER'
        <if test="status != null and status != 'ALL'">
            AND user_status = #{status}
        </if>
        ORDER BY created_at DESC
        LIMIT #{size} OFFSET #{offset}
    </select>

    <!-- 매니저 목록 조회 (MANAGER 역할만) -->
    <select id="getManagerList" resultType="com.popspot.popupplatform.dto.admin.AdminUserDTO">
        SELECT
        user_id AS userId,
        user_name AS userName,
        user_nickname AS userNickname,
        user_email AS userEmail,
        user_phonenumber AS userPhonenumber,
        user_gender AS userGender,
        user_birthyear AS userBirthyear,
        user_status AS userStatus,
        user_role AS userRole,
        created_at AS createdAt,
        updated_at AS updatedAt
        FROM USER
        WHERE user_role = 'MANAGER'
        <if test="status != null and status != 'ALL'">
            AND user_status = #{status}
        </if>
        ORDER BY created_at DESC
        LIMIT #{size} OFFSET #{offset}
    </select>

    <!-- 유저 총 개수 -->
    <select id="getUserCount" resultType="int">
        SELECT COUNT(*)
        FROM USER
        WHERE user_role = 'USER'
        <if test="status != null and status != 'ALL'">
            AND user_status = #{status}
        </if>
    </select>

    <!-- 매니저 총 개수 -->
    <select id="getManagerCount" resultType="int">
        SELECT COUNT(*)
        FROM USER
        WHERE user_role = 'MANAGER'
        <if test="status != null and status != 'ALL'">
            AND user_status = #{status}
        </if>
    </select>

    <!-- 유저 상태 변경 -->
    <update id="updateUserStatus">
        UPDATE USER
        SET user_status = #{status},
        updated_at = CURRENT_TIMESTAMP
        WHERE user_id = #{userId}
    </update>

    <!-- 유저 권한 변경 -->
    <update id="updateUserRole">
        UPDATE USER
        SET user_role = #{role},
        updated_at = CURRENT_TIMESTAMP
        WHERE user_id = #{userId}
    </update>

</mapper>